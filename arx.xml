<project>
    <shortName>ARX</shortName>
    <fullName>ARX</fullName>
    <version>3.9.1</version>
    <createOsxBundleZip>1</createOsxBundleZip>
    <outputDirectory>${build_project_directory}/installers/</outputDirectory>
    <licenseFile>${build_project_directory}/arx-license.txt</licenseFile>
    <leftImage>${build_project_directory}/icons/logo_64.png</leftImage>
    <logoImage>${build_project_directory}/icons/logo_48.png</logoImage>
    <splashImage>${build_project_directory}/icons/splash.png</splashImage>
    <componentList>
        <component>
            <name>default</name>
            <description>Default Component</description>
            <canBeEdited>1</canBeEdited>
            <selected>1</selected>
            <show>1</show>
            <folderList>
                <folder>
                    <description>Program Files</description>
                    <destination>${installdir}</destination>
                    <name>programfiles</name>
                    <platforms>all</platforms>
                    <distributionFileList>
                        <distributionFile>
                            <origin>${build_project_directory}/icons/logo.ico</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>${build_project_directory}/icons/logo_48.png</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>${build_project_directory}/icons/logo_64.png</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>${build_project_directory}/icons/logo_256.png</origin>
                        </distributionFile>
                        <distributionDirectory>
                            <origin>${build_project_directory}/bin</origin>
                        </distributionDirectory>
                    </distributionFileList>
                    <shortcutList>
                        <shortcut>
                            <comment>Uninstall</comment>
                            <exec>${installdir}/${uninstallerName}</exec>
                            <icon></icon>
                            <name>Uninstall ${product_fullname}-${project.version}</name>
                            <path>${installdir}</path>
                            <platforms>all</platforms>
                            <runAsAdmin>0</runAsAdmin>
                            <runInTerminal>0</runInTerminal>
                            <windowsExec>${installdir}/${uninstallerName}.exe</windowsExec>
                            <windowsExecArgs></windowsExecArgs>
                            <windowsIcon></windowsIcon>
                            <windowsPath>${installdir}</windowsPath>
                        </shortcut>
                    </shortcutList>
                </folder>
                <folder>
                    <description>Program Files</description>
                    <destination>${installdir}</destination>
                    <name>programfileswindows64</name>
                    <platforms>windows</platforms>
                    <distributionFileList>
                        <distributionFile>
                            <origin>${build_project_directory}/arx-${project.version}-win-64.jar</origin>
                        </distributionFile>
                    </distributionFileList>
                    <ruleList>
                        <platformTest>
                            <type>windows</type>
                        </platformTest>
                    </ruleList>
                </folder>
                <folder>
                    <description>Program Files</description>
                    <destination>${installdir}</destination>
                    <name>programfilesosx</name>
                    <platforms>osx</platforms>
                    <distributionFileList>
                        <distributionFile>
                            <origin>${build_project_directory}/arx-${project.version}-osx-64.jar</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>${build_project_directory}/Info.plist</origin>
                        </distributionFile>
                        <distributionDirectory>
                            <origin>${build_project_directory}/icons/Resources</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>${build_project_directory}/MacOS</origin>
                        </distributionDirectory>
                    </distributionFileList>
                </folder>
                <folder>
                    <description>Program Files</description>
                    <destination>${installdir}</destination>
                    <name>programfileslinux64</name>
                    <platforms>linux-x64</platforms>
                    <distributionFileList>
                        <distributionFile>
                            <origin>${build_project_directory}/arx-${project.version}-gtk-64.jar</origin>
                        </distributionFile>
                    </distributionFileList>
                </folder>
            </folderList>
            <startMenuShortcutList>
                <startMenuShortcut>
                    <comment>Uninstall ${product_fullname}-${project.version}</comment>
                    <name>Uninstall ${product_fullname}-${project.version}</name>
                    <runAsAdmin>0</runAsAdmin>
                    <runInTerminal>0</runInTerminal>
                    <windowsExec>${installdir}/${uninstallerName}.exe</windowsExec>
                    <windowsExecArgs></windowsExecArgs>
                    <windowsIcon></windowsIcon>
                    <windowsPath>${installdir}/</windowsPath>
                </startMenuShortcut>
            </startMenuShortcutList>
        </component>
        <include>
            <file>E:\java\java.xml</file>
        </include>
    </componentList>
    <initializationActionList>
        <setInstallerVariable>
            <name>java_launcher_jar</name>
            <value>arx-${project.version}-win-64.jar</value>
            <ruleList>
                <platformTest>
                    <type>windows</type>
                </platformTest>
            </ruleList>
        </setInstallerVariable>
        <setInstallerVariable>
            <name>java_launcher_jar</name>
            <value>arx-${project.version}-gtk-64.jar</value>
            <ruleList>
                <platformTest>
                    <type>linux-x64</type>
                </platformTest>
            </ruleList>
        </setInstallerVariable>
        <setInstallerVariable>
            <name>java_launcher_jar</name>
            <value>arx-${project.version}-osx-64.jar</value>
            <ruleList>
                <platformTest>
                    <type>osx</type>
                </platformTest>
            </ruleList>
        </setInstallerVariable>
        <setInstallerVariable>
            <name>java_launcher_vm_parameters</name>
            <value>-XstartOnFirstThread -XX:MaxRAMFraction=1</value>
            <ruleList>
                <platformTest>
                    <type>osx</type>
                </platformTest>
            </ruleList>
        </setInstallerVariable>
        <setInstallerVariable>
            <name>java_launcher_vm_parameters</name>
            <value>-XX:MaxRAMFraction=1</value>
            <ruleList>
                <platformTest>
                    <negate>1</negate>
                    <type>osx</type>
                </platformTest>
            </ruleList>
        </setInstallerVariable>
    </initializationActionList>
    <postInstallationActionList>
        <associateWindowsFileExtension>
            <extensions>.deid</extensions>
            <friendlyName></friendlyName>
            <icon>${installdir}/logo.ico</icon>
            <mimeType>application/arx</mimeType>
            <progID>arx.project.2</progID>
            <commandList>
                <command>
                    <makeDefault>1</makeDefault>
                    <runProgram>${installdir}\${project.shortName}-launcher.${platform_exec_suffix}</runProgram>
                    <runProgramArguments>"%L"</runProgramArguments>
                    <verb>Open</verb>
                </command>
            </commandList>
            <ruleList>
                <platformTest>
                    <type>windows</type>
                </platformTest>
            </ruleList>
        </associateWindowsFileExtension>
        <actionGroup>
            <actionList>
                <writeFile>
                    <path>${installdir}/${project.vendor}-${project.version}-x-arx.xml</path>

                    <!-- The CDATA notation allow escaping a
block of XML characters -->
                    <text>&lt;?xml version="1.0"?&gt;
&lt;mime-info xmlns="http://www.freedesktop.org/standards/shared-mime-info"&gt;
&lt;mime-type type="application/x-arx"&gt;
&lt;comment&gt;ARX Project File&lt;/comment&gt;
&lt;glob pattern="*.deid"/&gt;
&lt;/mime-type&gt;
&lt;/mime-info&gt;
</text>
                </writeFile>
                <runProgram>
                    <program>xdg-mime</program>
                    <programArguments>install ${installdir}/${project.vendor}-${project.version}-x-arx.xml</programArguments>
                </runProgram>
                <writeFile>
                    <encoding>utf-8</encoding>
                    <path>~/.local/share/applications/arx-${project.version}.desktop</path>
                    <text>[Desktop Entry]
Version=${project.version}
Encoding=UTF-8
Name=ARX-${project.version}
Comment=ARX Anonymization Tool
Exec=${installdir}/${project.shortName}-launcher.run
Icon=${installdir}/logo_256.png
Terminal=false
Type=Application
Categories=Application;Utility;
MimeType=application/x-arx
</text>
                </writeFile>
                <changePermissions>
                    <files>~/.local/share/applications/arx-${project.version}.desktop</files>
                    <permissions>764</permissions>
                </changePermissions>
                <runProgram>
                    <program>xdg-mime</program>
                    <programArguments>default arx-${project.version}.desktop application/x-arx</programArguments>
                </runProgram>
                <runProgram>
                    <program>update-desktop-database</program>
                    <programArguments>~/.local/share/applications</programArguments>
                </runProgram>
                <runProgram>
                    <program>update-mime-database</program>
                    <programArguments>~/.local/share/mime</programArguments>
                </runProgram>
                <runProgram>
                    <program>xdg-icon-resource</program>
                    <programArguments>install --size 256 --context mimetypes ${installdir}/logo_256.png application-x-arx</programArguments>
                </runProgram>
            </actionList>
            <ruleList>
                <platformTest>
                    <type>linux</type>
                </platformTest>
            </ruleList>
        </actionGroup>
        <actionGroup>
            <actionList>
                <runProgram>
                    <program>defaults</program>

                    <!-- The CDATA notation allow escaping a
block of XML characters -->
                    <programArguments>write com.apple.LaunchServices LSHandlers -array-add "&lt;dict&gt;&lt;key&gt;LSHandlerContentTag&lt;/key&gt;
&lt;string&gt;deid&lt;/string&gt;&lt;key&gt;LSHandlerContentTagClass&lt;/key&gt;
&lt;string&gt;public.filename-extension&lt;/string&gt;&lt;key&gt;LSHandlerRoleAll&lt;/key&gt;
&lt;string&gt;org.deidentifier.arx&lt;/string&gt;&lt;/dict&gt;"
</programArguments>
                </runProgram>

                <!-- Restart the launch services to reload the configuration -->
                <runProgram>
                    <program>/System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/LaunchServices.framework/Versions/A/Support/lsregister</program>
                    <programArguments>-kill -domain local -domain system -domain user</programArguments>
                </runProgram>
                <changePermissions>
                    <files>${installdir}/MacOS/run.sh</files>
                    <permissions>764</permissions>
                </changePermissions>
            </actionList>
            <ruleList>
                <platformTest>
                    <type>osx</type>
                </platformTest>
            </ruleList>
        </actionGroup>
        <addDirectoryToPath>
            <insertAt>beginning</insertAt>
            <path>${installdir}/bin</path>
        </addDirectoryToPath>
        <substitute>
            <files>${installdir}/bin/arx.bat</files>
            <type>exact</type>
            <ruleList>
                <platformTest>
                    <type>windows</type>
                </platformTest>
            </ruleList>
            <substitutionList>
                <substitution>
                    <pattern>@@JAVAEXECUTABLE@@</pattern>
                    <value>${installdir}/java/bin/java.exe</value>
                </substitution>
                <substitution>
                    <pattern>@@VERSION@@</pattern>
                    <value>${project.version}</value>
                </substitution>
                <substitution>
                    <pattern>@@INSTALLDIR@@</pattern>
                    <value>${installdir}</value>
                </substitution>
            </substitutionList>
        </substitute>
        <substitute>
            <files>${installdir}/bin/arx</files>
            <type>exact</type>
            <ruleList>
                <platformTest>
                    <negate>1</negate>
                    <type>windows</type>
                </platformTest>
            </ruleList>
            <substitutionList>
                <substitution>
                    <pattern>@@JAVAEXECUTABLE@@</pattern>
                    <value>${installdir}/java/bin/java</value>
                </substitution>
                <substitution>
                    <pattern>@@VERSION@@</pattern>
                    <value>${project.version}</value>
                </substitution>
                <substitution>
                    <pattern>@@INSTALLDIR@@</pattern>
                    <value>${installdir}</value>
                </substitution>
            </substitutionList>
        </substitute>
        <substitute>
            <files>${installdir}/bin/arx</files>
            <type>exact</type>
            <ruleList>
                <platformTest>
                    <type>osx</type>
                </platformTest>
            </ruleList>
            <substitutionList>
                <substitution>
                    <pattern>exec "${installdir}/${project.shortName}-launcher.run"</pattern>
                    <value>open "${installdir}/.."</value>
                </substitution>
            </substitutionList>
        </substitute>
        <changePermissions>
            <files>${installdir}/bin/arx</files>
            <permissions>764</permissions>
            <ruleList>
                <platformTest>
                    <negate>1</negate>
                    <type>windows</type>
                </platformTest>
            </ruleList>
        </changePermissions>
    </postInstallationActionList>
    <preUninstallationActionList>
        <removeWindowsFileAssociation>
            <extensions>.deid</extensions>
            <mimeType>application/arx</mimeType>
            <progID>arx.project.2</progID>
            <ruleList>
                <platformTest>
                    <type>windows</type>
                </platformTest>
            </ruleList>
        </removeWindowsFileAssociation>
        <actionGroup>
            <actionList>
                <runProgram>
                    <program>xdg-mime</program>
                    <programArguments>uninstall ${installdir}/${project.vendor}-${product_version}-x-arx.xml</programArguments>
                </runProgram>
                <deleteFile>
                    <path>~/.local/share/applications/arx-${product_version}.desktop</path>
                </deleteFile>
                <deleteFile>
                    <path>${installdir}/${project.vendor}-${product_version}-x-arx.xml</path>
                </deleteFile>
            </actionList>
            <ruleList>
                <platformTest>
                    <type>linux</type>
                </platformTest>
            </ruleList>
        </actionGroup>
        <deleteFile path="${installdir}/${project.shortName}-launcher.app"/>
        <removeDirectoryFromPath>
            <path>${installdir}/bin</path>
        </removeDirectoryFromPath>
    </preUninstallationActionList>
    <compressionAlgorithm>lzma-ultra</compressionAlgorithm>
    <enableRollback>1</enableRollback>
    <enableTimestamp>1</enableTimestamp>
    <vendor>ARX</vendor>
    <windows64bitMode>1</windows64bitMode>
    <parameterList>
        <directoryParameter>
            <name>installdir</name>
            <description>Installer.Parameter.installdir.description</description>
            <explanation>Installer.Parameter.installdir.explanation</explanation>
            <value></value>
            <default>${platform_install_prefix}/${product_shortname}-${product_version}</default>
            <allowEmptyValue>0</allowEmptyValue>
            <ask>yes</ask>
            <cliOptionName>prefix</cliOptionName>
            <mustBeWritable>yes</mustBeWritable>
            <mustExist>0</mustExist>
            <width>40</width>
            <postShowPageActionList>
                <setInstallerVariable>
                    <name>installdir</name>
                    <value>${installdir}.app/Contents</value>
                    <ruleList>
                        <platformTest>
                            <type>osx</type>
                        </platformTest>
                    </ruleList>
                </setInstallerVariable>
            </postShowPageActionList>
        </directoryParameter>
    </parameterList>
</project>

